{% extends 'base.html' %}
{% load static %}
{% block title %}PlanMyTrip – Viajes Públicos{% endblock %}

<style>
    .card-viaje {
        transition: all 0.3s ease;
        border: none;
        box-shadow: 0 4px 15px rgba(70, 146, 255, 0.1);
        border-radius: 16px;
        overflow: hidden;
    }

    .card-viaje:hover {
        transform: translateY(-8px);
        box-shadow: 0 12px 35px rgba(70, 146, 255, 0.2);
    }

    .hero-gradient {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }

    .glass-effect {
        backdrop-filter: blur(20px);
        background: rgba(255, 255, 255, 0.9);
        border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .btn-modern {
        border-radius: 25px;
        padding: 8px 20px;
        font-weight: 500;
        transition: all 0.3s ease;
    }

    .btn-modern:hover {
        transform: translateY(-2px);
    }

    .avatar-glow {
        box-shadow: 0 0 15px rgba(70, 146, 255, 0.3);
    }

    .stats-icon {
        background: linear-gradient(45deg, #667eea, #764ba2);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    .card-viaje:hover {
        transform: translateY(-8px);
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1) !important;
    }

    .card-viaje:hover img {
        transform: scale(1.05);
    }

    .card-viaje:hover .btn-like-viaje {
        transform: scale(1.1);
    }

    .card-viaje .rounded-circle:hover {
        transform: translateY(-2px);
    }

    .btn-modern:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4) !important;
    }
</style>

{% block content %}
    {% csrf_token %}
    <div class="wrapper d-flex flex-column min-vh-100">
        <!-- Navbar -->
        <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm sticky-top">
            <div class="container-fluid">
                <a class="navbar-brand fw-bold text-primary d-flex align-items-center" href="{% url 'viajes:inicio' %}">
                    <img src="{% static 'imagenes/logo.png' %}" width="45" height="45" alt="logo"
                         class="me-2 rounded-circle">
                    <span class="brand-text fs-4">PlanMyTrip</span>
                </a>

                <div class="d-flex align-items-center ms-auto">
                <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
                <ul class="navbar-nav me-4">
                    <li class="nav-item mx-2">
                        <a class="nav-link" href="{% url 'viajes:inicio'%}" style="color: #495057;">Página Principal</a>
                    </li>
                       <li class="nav-item mx-2">
                        <a class="nav-link" href="{% url 'viajes:viajes_publicos' %}" style="color: #495057;">Ideas de Viajes</a>
                    </li>
                </ul>
            </div>
                    <!-- Notificaciones -->
                    <div class="dropdown me-3">
                        <a href="#" class="position-relative text-dark btn btn-outline-light rounded-circle p-2"
                           data-bs-toggle="dropdown" aria-expanded="false" data-bs-toggle="tooltip"
                           title="Notificaciones">
                            <i class="fas fa-bell"></i>
                            {% if notificaciones_sin_leer_count > 0 %}
                                <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
                                    {{ notificaciones_sin_leer_count }}
                                </span>
                            {% endif %}
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end shadow-lg border-0" style="border-radius: 12px;">
                            <li class="dropdown-header text-primary fw-bold">Notificaciones recientes</li>
                            {% for notificacion in ultimas_notificaciones %}
                                {% if notificacion.leido == False %}
                                    <li>
                                        <a class="dropdown-item d-flex justify-content-between align-items-start py-2"
                                           href="{% url 'viajes:notificacion_redireccion' notificacion.pk %}">
                                            <div>
                                                <div class="notification-text">{{ notificacion.mensaje }}</div>
                                                <small class="text-muted">{{ notificacion.fecha_creacion|timesince }}</small>
                                            </div>
                                            <span class="badge bg-primary rounded-pill">nuevo</span>
                                        </a>
                                    </li>
                                {% endif %}
                            {% empty %}
                                <li><a class="dropdown-item text-muted">No hay nuevas notificaciones</a></li>
                            {% endfor %}
                            <li>
                                <hr class="dropdown-divider">
                            </li>
                            <li>
                                <a href="{% url 'viajes:notificaciones' %}"
                                   class="dropdown-item text-center text-primary fw-bold">
                                    Ver todas
                                </a>
                            </li>
                        </ul>
                    </div>

                    <!-- Menú de usuario -->
                    <div class="dropdown">
                        <a href="#" class="d-flex align-items-center text-dark text-decoration-none dropdown-toggle"
                           id="userDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                            <img src="

                                    {% if user.foto_perfil %}{{ user.foto_perfil.url }}{% else %}{% static 'imagenes/default-pic.png' %}{% endif %}"
                                 alt="Foto de perfil" width="40" height="40" class="rounded-circle me-2 avatar-glow">
                            <div class="d-none d-md-block">
                                <strong class="text-dark">{{ user.username }}</strong>
                            </div>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end shadow-lg border-0" style="border-radius: 12px;">
                            <li><a class="dropdown-item py-2" href="{% url 'viajes:ajustes_usuario' %}">
                                <i class="fas fa-user-cog me-2 text-primary"></i>Ajustes</a></li>
                            <li><a class="dropdown-item py-2" href="#">
                                <i class="fas fa-question-circle me-2 text-primary"></i>Ayuda</a></li>
                            <li>
                                <hr class="dropdown-divider">
                            </li>
                            <li>
                                <form action="{% url 'viajes:logout' %}" method="post">
                                    {% csrf_token %}
                                    <button type="submit" class="dropdown-item py-2 text-danger">
                                        <i class="fas fa-sign-out-alt me-2"></i>Cerrar sesión
                                    </button>
                                </form>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Hero Section -->
        <section class="hero-gradient py-4 text-center text-white position-relative overflow-hidden" style="background: #0D6EFD; background: radial-gradient(circle,rgba(13, 110, 253, 1) 0%, rgba(70, 142, 250, 1) 50%, rgba(185, 212, 250, 1) 100%);">
            <div class="container py-3">
                <div class="row justify-content-center">
                    <div class="col-lg-10">
                        <h1 class="fs-2 fw-bold mb-2">Descubre Viajes Increíbles</h1>
                        <p class="mb-3 small opacity-75">Inspírate con experiencias reales de otros viajeros. ¡Explora,
                            sueña y planea!</p>
                        <div class="d-flex justify-content-center">
                            <div class="bg-white text-primary rounded-pill px-3 py-1 shadow-sm d-inline-flex align-items-center">
                                <i class="fas fa-users me-2"></i>
                                <span class="fw-semibold small">+{{ viajes|length }} viajes disponibles</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Barra de Búsqueda -->
        <section class="bg-light py-3 border-top border-bottom sticky-top shadow-sm" style="z-index: 1030;">
            <div class="container">
                <div class="row g-3 align-items-center">
                    <!-- Filtros rápidos -->
                    <div class="col-lg-4">
                        <div class="d-flex flex-wrap gap-2">
                            <a href="#"
                               class="btn btn-outline-primary btn-modern btn-sm filtro-btn"
                               data-filtro="continente"
                               data-valor="europa"
                               data-base-url="{% url 'viajes:viajes_publicos' %}"
                               data-destino="{{ filtro_destino }}"
                               class="{% if filtro_continente == 'europa' %}btn-primary text-white{% endif %}">
                                <i class="fas fa-map-marker-alt me-1"></i>Europa
                            </a>
                            <a href="#"
                               class="btn btn-outline-primary btn-modern btn-sm filtro-btn"
                               data-filtro="continente"
                               data-valor="otros"
                               data-base-url="{% url 'viajes:viajes_publicos' %}"
                               data-destino="{{ filtro_destino }}"
                               class="{% if filtro_continente == 'europa' %}btn-primary text-white{% endif %}">
                                <i class="fas fa-globe-americas me-1"></i>Fuera de Europa
                            </a>
                            <a href="#"
                               class="btn btn-outline-primary btn-modern btn-sm filtro-btn"
                               data-filtro="grupos_reducidos"
                               data-valor="1"
                               data-base-url="{% url 'viajes:viajes_publicos' %}"
                               data-destino="{{ filtro_destino }}"
                               class="{% if filtro_grupos_reducidos == '1' %}btn-primary text-white{% endif %}">
                                <i class="fas fa-users me-1"></i>Grupos pequeños
                            </a>
                        </div>
                    </div>

                    <!-- Buscador por destino -->
                    <div class="col-lg-5">
                        <form method="GET">
                            <div class="input-group shadow-sm">
                                <span class="input-group-text bg-white border-end-0">
                                    <i class="fas fa-search text-muted"></i>
                                </span>
                                <input type="text" class="form-control border-start-0 border-end-0" name="destino"
                                       placeholder="¿A dónde quieres ir?" value="{{ filtro_destino }}">
                                <button type="submit" class="btn btn-primary btn-modern">Buscar</button>
                            </div>
                        </form>
                    </div>

                    <!-- Ordenación -->
                    <div class="col-lg-3 text-end">
                        <div class="dropdown">
                            <button class="btn btn-outline-secondary btn-modern dropdown-toggle" type="button"
                                    data-bs-toggle="dropdown">
                                <i class="fas fa-sort me-1"></i>Ordenar por
                            </button>
                            <ul class="dropdown-menu dropdown-menu-end shadow border-0">
                                <li>
                                    <a class="dropdown-item text-danger" href="{% url 'viajes:viajes_publicos' %}">
                                        <i class="fas fa-times me-2"></i>Quitar filtros
                                    </a>
                                </li>
                                <li>
                                    <hr class="dropdown-divider">
                                </li>

                                <li>
                                    <a class="dropdown-item"
                                       href="?orden=fecha_viaje{% if filtro_destino %}&destino={{ filtro_destino }}{% endif %}{% if filtro_continente %}&continente={{ filtro_continente }}{% endif %}{% if filtro_grupos_reducidos %}&grupos_reducidos={{ filtro_grupos_reducidos }}{% endif %}">
                                        <i class="fas fa-calendar me-2"></i>Fecha de viaje
                                    </a>
                                </li>
                                <li>
                                    <a class="dropdown-item"
                                       href="?orden=populares{% if filtro_destino %}&destino={{ filtro_destino }}{% endif %}{% if filtro_continente %}&continente={{ filtro_continente }}{% endif %}{% if filtro_grupos_reducidos %}&grupos_reducidos={{ filtro_grupos_reducidos }}{% endif %}">
                                        <i class="fas fa-fire me-2"></i>Más populares
                                    </a>
                                </li>
                                <li>
                                    <a class="dropdown-item"
                                       href="?orden=alfabetico{% if filtro_destino %}&destino={{ filtro_destino }}{% endif %}{% if filtro_continente %}&continente={{ filtro_continente }}{% endif %}{% if filtro_grupos_reducidos %}&grupos_reducidos={{ filtro_grupos_reducidos }}{% endif %}">
                                        <i class="fas fa-sort-alpha-down me-2"></i>Alfabético
                                    </a>
                                </li>
                            </ul>
                            {% if orden %}
                                <p class="text-muted mt-2">Orden actual:
                                    {% if orden == 'fecha_viaje' %}Fecha de viaje{% elif orden == 'populares' %}Más
                                        populares{% elif orden == 'alfabetico' %}Alfabético{% endif %}
                                </p>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Main Content -->
        <main class="flex-grow-1 py-5 bg-light">
            <div class="container">
                <!-- Header de resultados -->
                <div class="row align-items-center mb-4">
                    <div class="col-md-8">
                        <h2 class="h3 mb-1">Viajes disponibles</h2>
                        <p class="text-muted mb-0">{{ viajes|length }} viaje{{ viajes|length|pluralize:"s" }}
                            encontrado{{ viajes|length|pluralize:"s" }}</p>
                    </div>
                    <div class="col-md-4 text-md-end">
                        {% if request.GET.destino %}
                            <span class="badge bg-primary rounded-pill px-3 py-2 fs-6">
                                <i class="fas fa-search me-1"></i>{{ request.GET.destino }}
                                <a href="{% url 'viajes:viajes_publicos' %}" class="text-white ms-2">
                                    <i class="fas fa-times"></i>
                                </a>
                            </span>
                        {% endif %}
                    </div>
                </div>

                <!-- Grid de viajes públicos -->
                {% if viajes %}
                    <!-- Grid de viajes públicos -->
                    {% if viajes %}
                        <div class="row g-4">
                            {% for viaje in viajes %}
                                <div class="col-lg-4 col-md-6">
                                    <div class="card card-viaje h-100 shadow-sm border-0"
                                         style="overflow: hidden; border-radius: 16px; transition: all 0.3s ease;">
                                        <!-- Imagen de cabecera -->
                                        <div class="position-relative" style="overflow: hidden;">
                                            {% if viaje.imagen %}
                                                <img src="{{ viaje.imagen.url }}"
                                                     class="card-img-top"
                                                     height="220"
                                                     style="object-fit: cover; transition: transform 0.3s ease;"
                                                     alt="{{ viaje.nombre }}">
                                            {% else %}
                                                <div class="card-img-top d-flex align-items-center justify-content-center"
                                                     style="height: 220px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); position: relative;">
                                                    <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.1);"></div>
                                                    <i class="fas fa-map-marked-alt text-white"
                                                       style="font-size: 3rem; opacity: 0.8; z-index: 1;"></i>
                                                </div>
                                            {% endif %}

                                            <!-- Badge del destino -->
                                            <div class="position-absolute top-0 start-0 m-3">
                            <span class="badge text-dark shadow-sm px-3 py-2"
                                  style="background: rgba(255,255,255,0.95); border-radius: 50px; backdrop-filter: blur(10px); font-weight: 600;">
                                <i class="fas fa-map-marker-alt me-1"
                                   style="color: #667eea;"></i>{{ viaje.destino.nombre }}
                            </span>
                                            </div>

                                            <!-- Badge de fecha de inicio -->
                                            <div class="position-absolute top-0 end-0 m-3">
                            <span class="badge text-white px-3 py-2"
                                  style="background: rgba(0,0,0,0.7); border-radius: 50px; backdrop-filter: blur(10px); font-weight: 500;">
                                <i class="fas fa-calendar me-1"></i>
                                {% if viaje.fecha_inicio %}
                                    {{ viaje.fecha_inicio|date:"d M" }}
                                {% else %}
                                    Por definir
                                {% endif %}
                            </span>
                                            </div>

                                            <!-- Overlay gradient sutil -->
                                            <div class="position-absolute bottom-0 start-0 end-0"
                                                 style="height: 60px; background: linear-gradient(transparent, rgba(0,0,0,0.1));"></div>
                                        </div>

                                        <div class="card-body d-flex flex-column p-4" style="background: #fafbfc;">
                                            <!-- Header del viaje -->
                                            <div class="d-flex justify-content-between align-items-start mb-3">
                                                <h5 class="card-title fw-bold mb-0"
                                                    style="color: #2c3e50; font-size: 1.25rem; line-height: 1.3;">{{ viaje.nombre }}</h5>
                                                <div class="d-flex align-items-center gap-2">
                                                    <button class="btn btn-sm btn-link p-0 btn-like-viaje"
                                                            data-viaje-id="{{ viaje.pk }}"
                                                            style="transition: transform 0.2s ease;">
                                                        {% if viaje.pk in liked_viajes_ids %}
                                                            <i class="fas fa-heart text-danger fs-5"></i>
                                                        {% else %}
                                                            <i class="far fa-heart text-danger fs-5"></i>
                                                        {% endif %}
                                                    </button>
                                                    <span class="badge text-dark like-count like-viewer like-count-{{ viaje.id }}"
                                                          data-viaje-id="{{ viaje.id }}"
                                                          style="cursor: pointer; background: #e9ecef; border-radius: 12px; font-weight: 600; font-size: 0.75rem;">
                                        {{ viaje.me_gustas_viaje.count }}
                                </span>
                                                </div>
                                            </div>

                                            <!-- Fechas del viaje -->
                                            <div class="mb-4">
                                                <p class="card-text text-muted mb-0" style="font-size: 0.9rem;">
                                                    <strong style="color: #495057;">Fechas:</strong>
                                                    {% if viaje.fecha_inicio and viaje.fecha_fin %}
                                                        {{ viaje.fecha_inicio|date:"d M Y" }} –
                                                        {{ viaje.fecha_fin|date:"d M Y" }}
                                                    {% else %}
                                                        Por definir
                                                    {% endif %}
                                                </p>
                                            </div>

                                            <!-- Info con iconos -->
                                            <div class="row mb-4">
                                                <div class="col-6">
                                                    <div class="text-center p-3 rounded-3"
                                                         style="background: linear-gradient(135deg, #667eea20, #764ba220); border: 1px solid #667eea30;">
                                                        <div class="mb-2">
                                                            <i class="fas fa-euro-sign"
                                                               style="font-size: 1.5rem; color: #667eea;"></i>
                                                        </div>
                                                        <div class="fw-bold" style="color: #2c3e50; font-size: 1.1rem;">
                                                            {% if viaje.presupuesto_estimado_por_persona %}
                                                                {{ viaje.presupuesto_estimado_por_persona }}€
                                                            {% else %}
                                                                --
                                                            {% endif %}
                                                        </div>
                                                        <small class="text-muted" style="font-size: 0.8rem;">por
                                                            persona</small>
                                                    </div>
                                                </div>
                                                <div class="col-6">
                                                    <div class="text-center p-3 rounded-3"
                                                         style="background: linear-gradient(135deg, #764ba220, #667eea20); border: 1px solid #764ba230;">
                                                        <div class="mb-2">
                                                            <i class="fas fa-users"
                                                               style="font-size: 1.5rem; color: #764ba2;"></i>
                                                        </div>
                                                        <div class="fw-bold" style="color: #2c3e50; font-size: 1.1rem;">
                                                            {{ viaje.colaboradores.count }}
                                                        </div>
                                                        <small class="text-muted" style="font-size: 0.8rem;">colaboradores</small>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Colaboradores con avatares mejorados -->
                                            {% if viaje.colaboradores.all %}
                                                <div class="mb-4">
                                                    <div class="d-flex align-items-center justify-content-between">
                                                        <div class="d-flex align-items-center">
                                                            <span class="text-muted me-2"
                                                                  style="font-size: 0.85rem; font-weight: 500;">Colaboradores:</span>
                                                            <div class="d-flex">
                                                                {% for participante in viaje.colaboradores.all|slice:":3" %}
                                                                    <img src="






                                                                            {% if participante.foto_perfil %}{{ participante.foto_perfil.url }}{% else %}{% static 'imagenes/default-pic.png' %}{% endif %}"
                                                                         class="rounded-circle border-2 border-white shadow-sm"
                                                                         width="36" height="36"
                                                                         style="margin-left: -8px; transition: transform 0.2s ease;"
                                                                         alt="{{ participante.username }}"
                                                                         title="{{ participante.username }}">
                                                                {% endfor %}
                                                                {% if viaje.colaboradores.count > 3 %}
                                                                    <div class="rounded-circle border-2 border-white shadow-sm bg-light d-flex align-items-center justify-content-center text-muted fw-bold"
                                                                         style="width: 36px; height: 36px; margin-left: -8px; font-size: 0.75rem; background: linear-gradient(135deg, #f8f9fa, #e9ecef) !important;">
                                                                        +{{ viaje.colaboradores.count|add:"-3" }}
                                                                    </div>
                                                                {% endif %}
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            {% endif %}

                                            <!-- Botón de acción mejorado -->
                                            <a href="{% url 'viajes:detalles_viaje' viaje.pk %}"
                                               class="btn btn-modern btn-primary mt-auto d-flex align-items-center justify-content-center py-3"
                                               style="border: none; border-radius: 12px; color: white; font-weight: 600; text-decoration: none; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);">
                                                <i class="fas fa-arrow-right me-2"></i>Ver detalles
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    {% endif %}

                    <!-- Paginación -->
                    {% if is_paginated %}
                        <nav aria-label="Navegación de viajes" class="mt-5">
                            <ul class="pagination justify-content-center">
                                {% if page_obj.has_previous %}
                                    <li class="page-item">
                                        <a class="page-link rounded-pill me-2" href="?page=1">Primera</a>
                                    </li>
                                    <li class="page-item">
                                        <a class="page-link rounded-pill me-2"
                                           href="?page={{ page_obj.previous_page_number }}">Anterior</a>
                                    </li>
                                {% endif %}

                                <li class="page-item active">
                                    <span class="page-link rounded-pill bg-primary border-primary">
                                        {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}
                                    </span>
                                </li>

                                {% if page_obj.has_next %}
                                    <li class="page-item">
                                        <a class="page-link rounded-pill ms-2"
                                           href="?page={{ page_obj.next_page_number }}">Siguiente</a>
                                    </li>
                                    <li class="page-item">
                                        <a class="page-link rounded-pill ms-2"
                                           href="?page={{ page_obj.paginator.num_pages }}">Última</a>
                                    </li>
                                {% endif %}
                            </ul>
                        </nav>
                    {% endif %}

                {% else %}
                    <!-- Estado vacío -->
                    <div class="text-center py-5">
                        <div class="mb-4">
                            <div class="d-inline-flex align-items-center justify-content-center bg-light rounded-circle"
                                 style="width: 120px; height: 120px;">
                                <i class="fas fa-map-marked-alt text-muted" style="font-size: 3rem;"></i>
                            </div>
                        </div>
                        <h3 class="mb-3">No hay viajes disponibles</h3>
                        <p class="text-muted mb-4 fs-5">¡Sé el primero en crear un viaje público y compartir tu
                            aventura!</p>
                        <a href="{% url 'viajes:crear_viaje' %}" class="btn btn-primary btn-lg btn-modern">
                            <i class="fas fa-plus me-2"></i>Crear mi primer viaje
                        </a>
                    </div>
                {% endif %}
            </div>
        </main>

        <!-- Footer -->
        <footer class="footer py-5"
                style="background-color: #f8f9fa; color: #495057; border-top: 1px solid #e1e5ee;">
            <div class="container">
                <div class="row">
                    <div class="col-lg-4 mb-4 mb-lg-0">
                        <h5 class="mb-3" style="color: #4692ff;">
                            <img src="{% static 'imagenes/logo.png' %}" width="40" height="40" alt="logo"
                                 class="me-2">
                            PlanMyTrip
                        </h5>
                        <p>La mejor manera de planificar viajes en grupo con tus amigos.</p>
                    </div>
                    <div class="col-lg-2 col-md-6 mb-4 mb-md-0">
                        <h5 class="mb-3" style="color: #4692ff;">Enlaces</h5>
                        <ul class="list-unstyled">
                            <li class="mb-2"><a href="#funcionalidades" class="text-decoration-none"
                                                style="color: #495057;">Funcionalidades</a></li>
                            <li class="mb-2"><a href="#testimonios" class="text-decoration-none"
                                                style="color: #495057;">Testimonios</a>
                            </li>
                            <li><a href="{% url 'viajes:login' %}" class="text-decoration-none"
                                   style="color: #495057;">Iniciar
                                sesión</a></li>
                        </ul>
                    </div>
                    <div class="col-lg-3 col-md-6 mb-4 mb-md-0">
                        <h5 class="mb-3" style="color: #4692ff;">Legal</h5>
                        <ul class="list-unstyled">
                            <li class="mb-2"><a href="#" class="text-decoration-none" style="color: #495057;">Términos
                                de
                                uso</a></li>
                            <li class="mb-2"><a href="#" class="text-decoration-none" style="color: #495057;">Política
                                de
                                privacidad</a></li>
                            <li><a href="#" class="text-decoration-none" style="color: #495057;">Cookies</a></li>
                        </ul>
                    </div>
                    <div class="col-lg-3 col-md-6">
                        <h5 class="mb-3" style="color: #4692ff;">Síguenos</h5>
                        <div class="d-flex gap-3">
                            <a href="#" class="text-decoration-none" style="color: #495057;"><i
                                    class="fab fa-facebook-f fa-lg"></i></a>
                            <a href="#" class="text-decoration-none" style="color: #495057;"><i
                                    class="fab fa-twitter fa-lg"></i></a>
                            <a href="#" class="text-decoration-none" style="color: #495057;"><i
                                    class="fab fa-instagram fa-lg"></i></a>
                            <a href="#" class="text-decoration-none" style="color: #495057;"><i
                                    class="fab fa-linkedin-in fa-lg"></i></a>
                        </div>
                    </div>
                </div>
                <hr class="my-4" style="border-color: rgba(0,0,0,0.1);">
                <div class="text-center">
                    <p class="mb-0 small">&copy; 2025 PlanMyTrip. Todos los derechos reservados.</p>
                </div>
            </div>
        </footer>

        <!-- Modal para mostrar los likes -->
        <div class="modal fade" id="likesModal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">A quienes les gustó</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <ul id="likes-list" class="list-unstyled mb-0">
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            document.querySelectorAll('.btn-like-viaje').forEach(function (btn) {
                btn.addEventListener('click', function (event) {
                    event.preventDefault();
                    const viajeId = this.dataset.viajeId;
                    const urlTemplate = "{% url 'viajes:toggle_like_viaje' 0 %}";
                    const url = urlTemplate.replace('/0/', `/${viajeId}/`);

                    fetch(url, {
                        method: 'POST',
                        headers: {
                            'X-CSRFToken': '{{ csrf_token }}',
                            'X-Requested-With': 'XMLHttpRequest',
                            'Content-Type': 'application/json'
                        },
                        credentials: 'same-origin'
                    })
                        .then(response => {
                            if (!response.ok) throw new Error('Error en la petición');
                            return response.json();
                        })
                        .then(data => {
                            const icono = btn.querySelector('i.fa-heart');
                            const contador = document.querySelector(`.like-count-${viajeId}`);

                            if (data.liked) {
                                icono.classList.remove('far');
                                icono.classList.add('fas');
                            } else {
                                icono.classList.remove('fas');
                                icono.classList.add('far');
                            }

                            if (contador) {
                                contador.textContent = data.count;
                            }
                        })
                        .catch(error => {
                            console.error('Error al alternar like:', error);
                        });
                });
            });

            document.querySelectorAll('.like-viewer').forEach(function (el) {
                el.addEventListener('click', function () {
                    const viajeId = this.dataset.viajeId;
                    const url = "{% url 'viajes:likes_viaje' 0 %}".replace('/0/', `/${viajeId}/`);

                    fetch(url, {
                        headers: {
                            'X-Requested-With': 'XMLHttpRequest'
                        },
                        credentials: 'same-origin'
                    })
                        .then(response => response.json())
                        .then(data => {
                            const listContainer = document.getElementById('likes-list');
                            listContainer.innerHTML = '';

                            if (data.usuarios.length === 0) {
                                listContainer.innerHTML = '<li class="text-muted">Nadie ha dado me gusta todavía.</li>';
                            } else {
                                data.usuarios.forEach(user => {
                                    const li = document.createElement('li');
                                    li.className = "d-flex align-items-center mb-2";

                                    const avatar = document.createElement('img');
                                    avatar.src = user.foto_perfil || '{% static "imagenes/default-pic.png" %}';
                                    avatar.className = "rounded-circle me-2";
                                    avatar.style.width = "32px";
                                    avatar.style.height = "32px";
                                    avatar.alt = user.username;

                                    const nameSpan = document.createElement('span');
                                    nameSpan.textContent = user.username;

                                    li.appendChild(avatar);
                                    li.appendChild(nameSpan);
                                    listContainer.appendChild(li);
                                });
                            }

                            const modal = new bootstrap.Modal(document.getElementById('likesModal'));
                            modal.show();
                        })
                        .catch(error => {
                            console.error('Error cargando likes del viaje:', error);
                        });
                });
            });

            document.querySelectorAll('.filtro-btn').forEach(function (btn) {
                btn.addEventListener('click', function (e) {
                    e.preventDefault();
                    const url = new URL(window.location.href);
                    const filtro = this.dataset.filtro;
                    const valor = this.dataset.valor;

                    if (url.searchParams.get(filtro) === valor) {
                        url.searchParams.delete(filtro);
                    } else {
                        url.searchParams.set(filtro, valor);
                    }

                    const destino = this.dataset.destino;
                    if (destino) {
                        url.searchParams.set('destino', destino);
                    }

                    window.location.href = url.toString();
                });
            });
        });
    </script>

{% endblock %}
